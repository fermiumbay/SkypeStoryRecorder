<h1>スカイプ物語レコーダー</h1>
本ソフトはスカイプを用いて多人数で物語・小説を書くときに<br>
テキストのうち物語部分を取り出して記録するための機械です。<br>
<hr>

<h2>もくじ</h2>
<ul>
<li><a href = "#files">ファイルの説明</a></li>
<li><a href = "#first">初めて使う場合</a></li>
<li><a href = "#menu">項目説明</a></li>
<li><a href = "#note">メモについて</a></li>
<li><a href = "#update">更新について</a></li>
<li><a href = "#error">不具合に思える仕様</a></li>
</ul>
<hr>

<div id = "files"></div>
<h2>ファイルの説明</h2>
<table border = "3"><tbody>
<tr>
	<th>ファイル名</th>
	<th>概要</th>
</tr>
<tr>
	<td>スカイプ物語レコーダー.exe</td>
	<td>実際に実行するGUIプログラムです。<br>物語の管理と、更新機能とのリンクをします。</td>
</tr>
<tr>
	<td>SkypeStoryRecorder.exe</td>
	<td>更新機能本体です。こちらはCUIです。<br>実際にはGUI側から呼び出して用いる方が便利ですので<br>こちらを単体で実行することはありません。</td>
</tr>
<tr>
	<td>dat/chara.dat</td>
	<td>キャラクターの登録情報が保存されています。<br>更新時に必要であれば自動で読み書きされます。<br>テキストエディタで開き、直接いじることも可能です。</td>
</tr>
<tr>
	<td>dat/update.dat</td>
	<td>ストーリーの更新日時情報が保存されています。<br>こちらも更新時に自動で生成されます。<br>更新はこの情報をもとに行います。</td>
</tr>
<tr>
	<td>dat/*.story</td>
	<td>保存されたストーリーのデータです。<br>これをもとにテキスト出力をします。</td>
</tr>
<tr>
	<td>story/*.txt<br>story/*_detail.txt</td>
	<td>ストーリーを読める形にしたテキストと、<br>詳細情報を含んだテキストです。<br>どちらもstoryフォルダに保存されますが、<br>スカイプ物語レコーダー.exeから見ることも可能です。</td>
</tr>
</tbody></table>
<hr>

<div id = "first"></div>
<h2>初めて使う場合</h2>
スカイプ物語レコーダー.exeを起動してください。下のような画面が表示されます。<br>
<br>
<img src = "説明書素材\1.JPG"><br>
<br>
「新規」ボタンを押すと、新しいストーリーを作成します。<br>
<br>
<img src = "説明書素材\2.JPG"><br>
<br>
ストーリーファイルはdatフォルダ以下に保存され、作成パスを無記入にするとdat内にじか置きされます。<br>
通常はそれでよいのですが、ジャンル分けなどしたい場合にdat以下にさらにフォルダを作成し、<br>
それぞれに分類して保存する場合は、作成パスを入力してください。
パスの区切り文字は半角スラッシュ（/）です。<br>
「...」ボタンから既存フォルダを選択できます。フォルダはdat以下でなければなりません。<br>
<br>
<img src = "説明書素材\3.JPG"><br>
<br>
OKを押して問題がなければ、上のようなダイアログボックスが表示されます。<br>
クリップボードにコマンドがコピーされますので、スカイプで貼り付けてください。<br>
この段階ではストーリーは保存されず、ただコマンドがコピーされるだけになります。<br>
<br>
<img src = "説明書素材\4.JPG"><br>
<br>
コマンドをスカイプのメッセージボックスに貼り付けて送信します。<br>
以後、ストーリーの作成を行うことができるようになります。<br>
<br>
<img src = "説明書素材\5.JPG"><br>
<br>
キャラクターの会話は、キャラクター名の直後にかぎかっこで区切ることにより、<br>
キャラクターの抽出機能が利用できるようになりますので、そのように書くのが良いでしょう。<br>
もちろん、そのようなルールに従う必要はありません。てきとうにやり取りをします。<br>
<br>
<img src = "説明書素材\6.JPG"><br>
<br>
ある程度書いたら、ストーリーの更新をしましょう。<br>
実際には、その日の作成を終えるときを区切りに更新をすると効率的です。<br>
メッセージをすべて選択してコピーします。<br>
<br>
<img src = "説明書素材\7.JPG"><br>
<br>
ためしにメモ帳に貼り付けてみると、このようにコピーされていることが分かります。<br>
スカイプのテキストは発言時刻と発言者の後に本文が来るようなスタイルになっています。<br>
次の更新のときにどうやってもストーリーが見つけられないという事態がありましたら、<br>
<b>この発言時刻と発言者の情報が抜け落ちている</b>可能性があります。<br>
そういう場合はこのようにテキストエディタに貼り付けて、日時などを捏造して追加すればよいと思います＾＾；<br>
スカイプがアップデートしたことにより、どうやら先頭の日時が抜け落ちるようになってしまったようです。<br>
このようなことをしなければならないのは恐らく初回のみなので、ご安心ください。<br>
<br>
<img src = "説明書素材\8.JPG"><br>
<br>
テキストをコピーした状態で「更新」を押すと、CUIが起動してテキストの解析を始めます。<br>
物語中にキャラクターの会話があった場合、それをキャラクターとして記録することができます。<br>
<br>
<table border = "3"><tbody>
<tr>
	<th>番号</th>
	<th>項目名</th>
	<th>概要</th>
</tr>
<tr>
	<td>1</td>
	<td>メイン</td>
	<td>キャラクターを「メインキャラ」として保存します。<br>データはdat/chara.datに保存されます。</td>
</tr>
<tr>
	<td>2</td>
	<td>サブ</td>
	<td>キャラクターを「サブキャラ」として保存します。<br>メインと扱いは別に変わらないですが、区別したい場合はお使いください。</td>
</tr>
<tr>
	<td>3</td>
	<td>無視</td>
	<td>その名前のキャラクターを今後無視します。<br>例えば「新聞」とか「手紙」とか、そういうのはキャラクターじゃないので<br>無視するように設定したほうが便利なことがあります。<br>無視を解除するにはdat/chada.datの中から<br>登録したキャラクターの項目を削除してください。</td>
</tr>
<tr>
	<td>0</td>
	<td>保留</td>
	<td>今決めるのはめんどくさいときなどに用います。<br>この回の更新ではスルーされ、次の更新時に再度聞かれます。</td>
</tr>
<tr>
	<td>-1</td>
	<td>全部保留</td>
	<td>この回のキャラを以後すべて保留にします。<br>保留同様、次の更新時にもあった場合、再び聞かれます。</td>
</tr>
</tbody></table>
<br>
ここでは「ベイ助」「ライ太」ともにメインに設定しました。<br>
<br>
<img src = "説明書素材\9.JPG"><br>
<br>
初回の更新時にはよく聞かれる、未知のストーリーが断定できなかったというエラーメッセージです。<br>
「ストーリー『楽しい物語』の更新を完了しました。」とあるように、ストーリーはすでに発見されていますが、<br>
この場合はそのさらに上でストーリーに関係ない会話をしていたため、<br>
それが何かのストーリーの一部なのでは？　と思われたためにこのようなメッセージが表示されました。<br>
この場合はこれらはストーリーではないので、2の「無視して再開」を選択します。<br>
今回はそういう事情でこれを選びますが、当然常に無視しちゃダメです。むしろ主に中断が推奨されます。<br>
<br>
<img src = "説明書素材\10.JPG"><br>
<br>
処理が完了しました。<br>
失敗と表示されていますが、前述のように今回のこれは別に失敗ではありません。<br>
ただ今後ストーリーを続けていくと、失敗を意味する可能性が高くなります。<br>
正常に終了した場合は自動で処理が終了しますが、今回のように失敗があると<br>
再度更新処理を実行するかどうか聞かれます。<br>
y以外のてきとうな文字（理想としてはnですが）を入力して更新を終了してください。<br>
<br>
<img src = "説明書素材\11.JPG"><br>
<br>
こうして無事ストーリーの更新が完了しました。<br>
このような要領でストーリーを作成、更新を行っていくことになります。<br>
<hr>

<div id = "menu"></div>
<h2>項目説明</h2>
リストのうちストーリーを選択してEnterを押すと、以下の項目の「読み込み」が行われます。<br>
各項目は主にリストで選択中のストーリーに対して適用されます。<br>
<br>
<table border = "3"><tbody>
<tr>
	<th>項目名</th>
	<th>概要</th>
</tr>
<tr>
	<td>新規</td>
	<td>ストーリーの新規作成。<br>コマンドがコピーされるので、<br>それをスカイプのメッセージボックスに貼り付けます。</td>
</tr>
<tr>
	<td>読み込み</td>
	<td>story/*.txtを読み込みます。<br>ストーリーを文章として読める形にしたものです。</td>
</tr>
<tr>
	<td>詳細表示</td>
	<td>story/*_detail.txtを読み込みます。<br>どんなキャラクターが登場するか、発言日時はいつか、<br>などの詳細情報を含んだテキストです。</td>
</tr>
<tr>
	<td>再開</td>
	<td>ストーリーを再開するコマンドをコピーします。<br>新規同様、スカイプのメッセージボックスにコピーしてください。</td>
</tr>
<tr>
	<td>要約変更</td>
	<td>要約を変更するコマンドをコピーします。<br>要約の更新も更新時にまとめて行われ、それまでは変化ありません。</td>
</tr>
<tr>
	<td>更新</td>
	<td>クリップボードにコピーされたテキストを解析し、<br>ストーリーの更新を行います。<br>これを行うまでストーリーが更新されませんので、<br>作業終了時に必ず実行するようにしてください。</td>
</tr>
</tbody></table>
<hr>

<div id = "note"></div>
<h2>メモについて</h2>
<img src = "説明書素材\12.JPG"><br>
<br>
スカイプの文中で全角の【】で囲んだ部分はメモとして扱われ、ストーリー文には反映されません。<br>
ファイルの送受信や通話、会議の作成などで表示されるシステムメッセージもメモとして扱われます。<br>
<br>
<img src = "説明書素材\13.JPG"><br>
<br>
メモのメッセージはストーリー本文ではすべて抜け落ちます。<br>
<br>
<img src = "説明書素材\14.JPG"><br>
<br>
メモの内容は「詳細表示」で確認することができます。<br>
メモは複数行にまたいでもOKですが、メッセージをまたぐことはできません。<br>
また、↑発言者の名前が無記入になってしまっていますが、<br>
これは不在着信のメッセージがシステムメッセージであるため、<br>
発言者の名前がスカイプで記録されないのが原因です。ご了承ください。<br>
<hr>

<div id = "update"></div>
<h2>更新について</h2>
すでに始めているストーリーの更新は、更新日時をもとにした推測により行うことができます。<br>
<br>
<img src = "説明書素材\15.JPG"><br>
<br>
上図を例にすると、２日目のストーリーが長くなってストーリーAの開始のコマンドが途中にない場合、<br>
わざわざ初めからコピーをしなくても、前日の更新の末尾さえ含んでいれば、<br>
どのストーリーかを推測することができるので、それを用いてストーリーAの更新を行うことができます。<br>
一つのストーリーが長大化してストーリー開始のコマンドが遠い前になってしまったとしても、<br>
適度に更新をすることによって繋げながら更新をしていくことが可能になるのです。<br>
スカイプでは過去の履歴は徐々に非表示になっていくため、<br>
基本的にすべて選択→コピーしたものを更新、とすればOKです。<br>
複数のストーリーをまたいでいたとしても問題ありません。<br>
<br>
<img src = "説明書素材\16.JPG"><br>
<br>
このように、未知のストーリーを探索したにも関わらず発見できなかったというエラーは、<br>
下図のような原理によるものです。<br>
<br>
<img src = "説明書素材\17.JPG"><br>
<br>
推測を行ったのですが、記録されているストーリーの末尾すべてと比較して<br>
一致するものが見つからなかったので、ストーリーの推定が行えない、という場合です。<br>
そのため、履歴を延ばして前回更新の末尾が現れるところまで含んでコピーすればよいのです。<br>
<br>
<img src = "説明書素材\18.JPG"><br>
<br>
もちろんストーリーが重複して保存されることはありません。<br>
更新をしばらく行っておらず、最終更新から離れている場合にはこのような現象が起こる可能性があります。<br>
日の終わりおきに更新をしていくのが効率的だという理由の一つです。<br>
<br>
また、未知のストーリーの推定で無視が推奨される場合もあります。<br>
<br>
<img src = "説明書素材\19.JPG"><br>
<br>
ストーリーの推定は末尾の時刻をもとに行いますので、<br>
間の時刻しか含まれていないストーリーでは推定ができないようにしています。<br>
これは更新機能の高速化のための処置です。<br>
履歴を逆に長く取りすぎて、すでに更新が終わっているストーリーを含んでいた場合、<br>
↑このようなエラーメッセージが表示されることがあります。<br>
表示されたストーリーのタイトルがその更新が終わっているストーリーと思われるものです。<br>
コピーしたものの中に表示されたストーリーのタイトルがあると思われれば、<br>
それがすでに更新を終えている更新不要のテキストとなります。<br>
もしそうであれば、更新は不要なので、無視して再開をすることが推奨されることになります。<br>
<br>

<hr>

<div id = "error"></div>
<h2>不具合に思える仕様</h2>
めったにないことではありますが、一つだけ、<br>
気づかずストーリーが歯抜けになってしまう現象があります。<br>
<br>
<img src = "説明書素材\20.JPG"><br>
<br>
まず、上図のようにA→B→Aの順にストーリーを行ったとき、<br>
更新２回目は初めのみ未知のストーリーではありますが、<br>
Aのストーリーであると推測できるため、Aのストーリーが更新されます。<br>
もし「Aのストーリー２」を含んでおらず、「Aのストーリー３」からだったとすると<br>
断定できないストーリーがあったとしてエラーが表示され、処理の中断を推奨されますから<br>
履歴が短いということが伝えられ、長く延ばして再トライすることができます。<br>
しかし、下図のように更新を行ってしまうと良くないことが起こります。<br>
<br>
<img src = "説明書素材\21.JPG"><br>
<br>
こうすると、更新２回目は未知のストーリーがないので正常に更新できてしまい、<br>
結果、「Aのストーリー３」が抜け落ちた状態で更新が終了してしまいます。<br>
これは、先ほどのエラー時に黙認で無視して再開をしてしまったのと同じことです。<br>
これではAの最終更新は「Aのストーリー５」になってしまい、「Aのストーリー３」が入れられなくなります。<br>
また、エラーが表示されないので気づけないことにもなってしまいます。<br>
<br>
そのため対策が必要に思われるのですが、現実的にこのようなことはないと考えられます。<br>
未知のストーリーが含まれなかった場合のエラーですが、すべて選択→コピーとしていれば<br>
先頭がストーリーの開始文になることはほぼありえませんから、<br>
実用上は問題ないと考えて差し支えありません。<br>
ただ、このような現象があるということは事実ですので、万が一抜け落ちのエラーがありましたら<br>
この現象が原因ではないかと考えられることになります。<br>
後からの追加は*.storyファイルをテキストエディタで開き、手動で追加することになります。<br>
<br>
もちろん、A→B→AではなくA→B→Cとした場合など、未更新の未知のストーリーに相当する部分が<br>
再びその該当ストーリーになる場合でなければこのような不具合は発生しません。<br>
ただ、同じ状況でA→B→Cとなっていた場合は、Aの最終更新を見過ごすことになる可能性はあります。<br>
<hr>

2015年1月13日 フェルミウム湾 記<br>
<br>